# Validate 'mdat' object generated by mmdata()
.validate.mdat <- function(mdat) {
  # Need to validate only once
  if (class(mdat) == "mdat" && attr(mdat, "validated")) {
    return(mdat)
  }

  # Check mdat
  if (class(mdat) != "mdat") {
    stop("'mdat' S3 object created by mmdata() expected")
  }

  # Check attributes
  if (length(mdat) != length(attr(mdat, "model_names"))) {
    stop("Invalid 'model_names'")
  }

  if (length(mdat) != length(attr(mdat, "data_nos"))) {
    stop("Invalid 'data_nos'")
  }

  attr(mdat, "validated") <- TRUE
  mdat
}

# Validate 'fmdat' object generated by reformat_data()
.validate.fmdat <- function(fmdat) {
  # Need to validate only once
  if (class(fmdat) == "fmdat" && attr(fmdat, "validated")) {
    return(fmdat)
  }

  # Validate class items and attributes
  item_names <- c("olabs", "ranks", "rank_idx")
  attr_names <- c("model_name", "data_no", "nn", "np", "args", "validated")
  arg_names <- c("na.last", "ties.method", "olevs", "model_name", "data_no")
  .validate_basic(fmdat, "fmdat", "reformat_data", item_names, attr_names,
                  arg_names)

  # Check values of class items
  if (length(fmdat[["olabs"]]) == 0
      || length(fmdat[["olabs"]]) != length(fmdat[["ranks"]])
      || length(fmdat[["olabs"]]) != length(fmdat[["rank_idx"]])) {
    stop("Items in 'fmdat' must be of the same length")
  }
  if (!is.ordered(fmdat[["olabs"]])
      || length(levels(fmdat[["olabs"]])) > 2) {
    stop("'olabs' in 'fmdat' must be an ordered factor with one or two levels")
  }
  if (!.is_numeric_vec(fmdat[["ranks"]])) {
    stop("'ranks' in 'fmdat' must be a numeric vector")
  }
  if (!.is_int_vec(fmdat[["rank_idx"]])) {
    stop("'rank_idx' in 'fmdat' must be a vector of integer")
  }

  attr(fmdat, "validated") <- TRUE
  fmdat
}

# Validate 'cmats' object generated by create_confmats()
.validate.cmats <- function(cmats) {
  # Need to validate only once
  if (class(cmats) == "cmats" && attr(cmats, "validated")) {
    return(cmats)
  }

  # Validate class items and attributes
  item_names <- c("pos_num", "neg_num", "tp", "fp", "tn", "fn", "ranks")
  attr_names <- c("model_name", "data_no", "nn", "np", "args", "cpp_errmsg",
                  "src", "validated")
  arg_names <- c("na.last", "ties.method", "olevs", "model_name", "data_no")
  .validate_basic(cmats, "cmats", "create_confmats", item_names, attr_names,
                  arg_names)

  # Check values of class items
  n <- length(cmats[["tp"]])
  if (length(cmats[["fp"]]) != n || length(cmats[["tn"]]) != n
      || length(cmats[["fn"]]) != n) {
    stop("tp, fp, tn, and fn in 'cmats' must be the same length")
  }
  stopifnot(.is_numeric_vec(cmats[["tp"]]),
            cmats[["tp"]][1] == 0,
            cmats[["tp"]][n] == cmats[["pos_num"]],
            .is_numeric_vec(cmats[["fp"]]),
            cmats[["fp"]][1] == 0,
            cmats[["fp"]][n] == cmats[["neg_num"]],
            .is_numeric_vec(cmats[["fn"]]),
            cmats[["fn"]][1] == cmats[["pos_num"]],
            cmats[["fn"]][n] == 0,
            .is_numeric_vec(cmats[["tn"]]),
            cmats[["tn"]][1] == cmats[["neg_num"]],
            cmats[["tn"]][n] == 0)

  attr(cmats, "validated") <- TRUE
  cmats
}

# Validate 'pevals' object generated by calc_measures()
.validate.pevals <- function(pevals) {
  # Need to validate only once
  if (class(pevals) == "pevals" && attr(pevals, "validated")) {
    return(pevals)
  }

  # Validate class items and attributes
  item_names <- c("pos_num", "neg_num", "error", "accuracy", "specificity",
                  "sensitivity", "precision")
  attr_names <- c("model_name", "data_no", "nn", "np", "args", "cpp_errmsg",
                  "src", "validated")
  arg_names <- c("na.last", "ties.method", "olevs", "model_name", "data_no")
  .validate_basic(pevals, "pevals", "calc_measures", item_names, attr_names,
                  arg_names)

  # Check values of class items
  n <- length(pevals[["error"]])
  if (length(pevals[["accuracy"]]) != n || length(pevals[["specificity"]]) != n
      || length(pevals[["sensitivity"]]) != n
      || length(pevals[["precision"]]) != n) {
    stop("All evaluation vectors must be the same length")
  }
  stopifnot(.is_numeric_vec(pevals[["error"]]),
            .is_numeric_vec(pevals[["accuracy"]]),
            pevals[["error"]][1] + pevals[["accuracy"]][1] == 1,
            pevals[["error"]][n] + pevals[["accuracy"]][n] ==1,
            .is_numeric_vec(pevals[["specificity"]]),
            pevals[["specificity"]][1] == 1,
            pevals[["specificity"]][n] == 0,
            .is_numeric_vec(pevals[["sensitivity"]]),
            pevals[["sensitivity"]][1] == 0,
            pevals[["sensitivity"]][n] == 1,
            .is_numeric_vec(pevals[["precision"]]),
            pevals[["precision"]][1] == pevals[["precision"]][2])

  attr(pevals, "validated") <- TRUE
  pevals
}

# Validate 'roc_curve' object generated by create_roc()
.validate.roc_curve <- function(roc_curve) {
  # Need to validate only once
  if (class(roc_curve) == "roc_curve" && attr(roc_curve, "validated")) {
    return(roc_curve)
  }

  # Validate class items and attributes
  .validate_curve(roc_curve, "roc_curve", "create_roc")

  attr(roc_curve, "validated") <- TRUE
  roc_curve
}

# Validate 'prc_curve' object generated by create_roc()
.validate.prc_curve <- function(prc_curve) {
  # Need to validate only once
  if (class(prc_curve) == "prc_curve" && attr(prc_curve, "validated")) {
    return(prc_curve)
  }

  # Validate class items and attributes
  .validate_curve(prc_curve, "prc_curve", "create_prc")

  attr(prc_curve, "validated") <- TRUE
  prc_curve
}

# Validate 'roc_curve' or 'prc_curve'
.validate_curve <- function(obj, class_name, func_name) {
  # Validate class items and attributes
  item_names <- c("x", "y", "orig_points")
  attr_names <- c("model_name", "data_no", "nn", "np", "auc", "partial", "pauc",
                  "x_limits", "y_limits", "args", "cpp_errmsg1", "cpp_errmsg2",
                  "src", "validated")
  arg_names <- c("x_interval", "na.last", "ties.method", "olevs",
                 "model_name", "data_no")
  .validate_basic(obj, class_name, func_name, item_names, attr_names,
                  arg_names)

  # Check values of class items
  if ((length(obj[["x"]]) != length(obj[["y"]]))
      || (length(obj[["x"]]) != length(obj[["orig_points"]]))) {
    stop("x, y, and orig_points must be the same length")
  } else if (!(length(obj[["x"]]) > 2)) {
    stop("x, y, and orig_points must be >2")
  }

  # Check values of class attributes
  stopifnot((attr(obj, "auc") >= 0) && (attr(obj, "auc") <= 1),
            (is.na(attr(obj, "pauc"))
             || (attr(obj, "pauc") >= 0 && attr(obj, "pauc") <= 1)),
            .is_logical_vec(attr(obj, "partial")),
            .is_numeric_vec(attr(obj, "x_limits")),
            length(attr(obj, "x_limits")) == 2,
            attr(obj, "x_limits")[1] >= 0 && attr(obj, "x_limits")[1] <= 1,
            attr(obj, "x_limits")[2] >= 0 && attr(obj, "x_limits")[2] <= 1,
            attr(obj, "x_limits")[1] < attr(obj, "x_limits")[2],
            .is_numeric_vec(attr(obj, "x_limits")),
            length(attr(obj, "y_limits")) == 2,
            attr(obj, "y_limits")[1] >= 0 && attr(obj, "y_limits")[1] <= 1,
            attr(obj, "y_limits")[2] >= 0 && attr(obj, "y_limits")[2] <= 1,
            attr(obj, "y_limits")[1] < attr(obj, "y_limits")[2])
}

# Validate 'curves' object generated by create_curves()
.validate.curves <- function(curves) {
  # Need to validate only once
  if (class(curves) == "curves" && attr(curves, "validated")) {
    return(curves)
  }

  # Validate class items and attributes
  item_names <- c("roc", "prc")
  attr_names <- c("model_name", "data_no", "nn", "np", "args", "src", "validated")
  arg_names <- c("x_interval", "na.last", "ties.method", "obslevels",
                 "model_name", "data_no")
  .validate_basic(curves, "curves", "calc_measures", item_names, attr_names,
                  arg_names)

  # Check values of class items
  curves[["roc"]] <- .validate(curves[["roc"]])
  curves[["prc"]] <- .validate(curves[["prc"]])

  attr(curves, "validated") <- TRUE
  curves
}
