# Validate 'fmdat' object generated by reformat_data()
.validate.fmdat <- function(fmdat) {
  # Need to validate only once
  if (class(fmdat) == "fmdat" && attr(fmdat, "validated")) {
    return
  }

  # Validate class items and attributes
  item_names <- c("obslabs", "ranks", "rank_idx")
  attr_names <- c("model_name", "nn", "np", "args", "validated")
  arg_names <- c("na.last", "ties.method", "obslevels", "model_name")
  .validate_basic(fmdat, "fmdat", "reformat_data", item_names, attr_names,
                  arg_names)

  # Check values of class items
  if (length(fmdat[["obslabs"]]) == 0
      || length(fmdat[["obslabs"]]) != length(fmdat[["ranks"]])
      || length(fmdat[["obslabs"]]) != length(fmdat[["rank_idx"]])) {
    stop("Items in 'fmdat' must be of the same length")
  }
  if (!is.ordered(fmdat[["obslabs"]])
      || length(levels(fmdat[["obslabs"]])) != 2) {
    stop("'obslabs' in 'fmdat' must be an ordered factor with two levels")
  }
  if (!.is_numeric_vec(fmdat[["ranks"]])) {
    stop("'ranks' in 'fmdat' must be a numeric vector")
  }
  if (!.is_int_vec(fmdat[["rank_idx"]])) {
    stop("'rank_idx' in 'fmdat' must be a vector of integer")
  }

  attr(fmdat, "validated") <- TRUE
  fmdat
}

# Validate 'cmats' object generated by create_confmats()
.validate.cmats <- function(cmats) {
  # Need to validate only once
  if (class(cmats) == "cmats" && attr(cmats, "validated")) {
    return
  }

  # Validate class items and attributes
  item_names <- c("pos_num", "neg_num", "tp", "fp", "tn", "fn", "ranks")
  attr_names <- c("model_name", "nn", "np", "args", "cpp_errmsg", "src",
                  "validated")
  arg_names <- c("na.last", "ties.method", "obslevels", "model_name")
  .validate_basic(cmats, "cmats", "create_confmats", item_names, attr_names,
                  arg_names)

  # Check values of class items
  n <- length(cmats[["tp"]])
  if (length(cmats[["fp"]]) != n || length(cmats[["tn"]]) != n
      || length(cmats[["fn"]]) != n) {
    stop("tp, fp, tn, and fn in 'cmats' must be the same length")
  }
  stopifnot(.is_numeric_vec(cmats[["tp"]]),
            cmats[["tp"]][1] == 0,
            cmats[["tp"]][n] == cmats[["pos_num"]],
            .is_numeric_vec(cmats[["fp"]]),
            cmats[["fp"]][1] == 0,
            cmats[["fp"]][n] == cmats[["neg_num"]],
            .is_numeric_vec(cmats[["fn"]]),
            cmats[["fn"]][1] == cmats[["pos_num"]],
            cmats[["fn"]][n] == 0,
            .is_numeric_vec(cmats[["tn"]]),
            cmats[["tn"]][1] == cmats[["neg_num"]],
            cmats[["tn"]][n] == 0)

  attr(cmats, "validated") <- TRUE
  cmats
}

# Validate 'evals' object generated by calc_measures()
.validate.evals <- function(evals) {
  # Need to validate only once
  if (class(evals) == "evals" && attr(evals, "validated")) {
    return
  }

  # Validate class items and attributes
  item_names <- c("pos_num", "neg_num", "error", "accuracy", "specificity",
                  "sensitivity", "precision")
  attr_names <- c("model_name", "nn", "np", "args", "cpp_errmsg", "src",
                  "validated")
  arg_names <- c("na.last", "ties.method", "obslevels", "model_name")
  .validate_basic(evals, "evals", "calc_measures", item_names, attr_names,
                  arg_names)

  # Check values of class items
  n <- length(evals[["error"]])
  if (length(evals[["accuracy"]]) != n || length(evals[["specificity"]]) != n
      || length(evals[["sensitivity"]]) != n
      || length(evals[["precision"]]) != n) {
    stop("All evaluation vectors must be the same length")
  }
  stopifnot(.is_numeric_vec(evals[["error"]]),
            .is_numeric_vec(evals[["accuracy"]]),
            evals[["error"]][1] + evals[["accuracy"]][1] == 1,
            evals[["error"]][n] + evals[["accuracy"]][n] ==1,
            .is_numeric_vec(evals[["specificity"]]),
            evals[["specificity"]][1] == 1,
            evals[["specificity"]][n] == 0,
            .is_numeric_vec(evals[["sensitivity"]]),
            evals[["sensitivity"]][1] == 0,
            evals[["sensitivity"]][n] == 1,
            .is_numeric_vec(evals[["precision"]]),
            evals[["precision"]][1] == evals[["precision"]][2])

  attr(evals, "validated") <- TRUE
  evals
}

# Validate 'roc_curve' or 'prc_curve'
.validate_curve <- function(obj, class_name, func_name) {
  # Validate class items and attributes
  item_names <- c("x", "y", "orig_points")
  attr_names <- c("model_name", "nn", "np", "auc", "auc2", "partial",
                  "x_limits", "y_limits", "args", "cpp_errmsg1", "cpp_errmsg2",
                  "src", "validated")
  arg_names <- c("x_interval", "na.last", "ties.method", "obslevels",
                 "model_name")
  .validate_basic(obj, class_name, func_name, item_names, attr_names,
                  arg_names)

  # Check values of class items
  if ((length(obj[["x"]]) != length(obj[["y"]]))
      || (length(obj[["x"]]) != length(obj[["orig_points"]]))) {
    stop("x, y, and orig_points must be the same length")
  } else if (!(length(obj[["x"]]) > 2)) {
    stop("x, y, and orig_points must be >2")
  }

  # Check values of class attributes
  stopifnot((attr(obj, "auc") >= 0) && (attr(obj, "auc") <= 1),
            (is.na(attr(obj, "auc2"))
             || (attr(obj, "auc2") >= 0 && attr(obj, "auc2") <= 1)),
            .is_logical_vec(attr(obj, "partial")),
            .is_numeric_vec(attr(obj, "x_limits")),
            length(attr(obj, "x_limits")) == 2,
            attr(obj, "x_limits")[1] >= 0 && attr(obj, "x_limits")[1] <= 1,
            attr(obj, "x_limits")[2] >= 0 && attr(obj, "x_limits")[2] <= 1,
            attr(obj, "x_limits")[1] < attr(obj, "x_limits")[2],
            .is_numeric_vec(attr(obj, "x_limits")),
            length(attr(obj, "y_limits")) == 2,
            attr(obj, "y_limits")[1] >= 0 && attr(obj, "y_limits")[1] <= 1,
            attr(obj, "y_limits")[2] >= 0 && attr(obj, "y_limits")[2] <= 1,
            attr(obj, "y_limits")[1] < attr(obj, "y_limits")[2])
}

# Validate 'roc_curve' object generated by create_roc()
.validate.roc_curve <- function(roc_curve) {
  # Need to validate only once
  if (class(roc_curve) == "roc_curve" && attr(roc_curve, "validated")) {
    return
  }

  # Validate class items and attributes
  .validate_curve(roc_curve, "roc_curve", "create_roc")

  attr(roc_curve, "validated") <- TRUE
  roc_curve
}

# Validate 'prc_curve' object generated by create_roc()
.validate.prc_curve <- function(prc_curve) {
  # Need to validate only once
  if (class(prc_curve) == "prc_curve" && attr(prc_curve, "validated")) {
    return
  }

  # Validate class items and attributes
  .validate_curve(prc_curve, "prc_curve", "create_prc")

  attr(prc_curve, "validated") <- TRUE
  prc_curve
}

# Validate 'curves' object generated by create_curves()
.validate.curves <- function(curves) {
  # Need to validate only once
  if (class(curves) == "curves" && attr(curves, "validated")) {
    return
  }

  # Validate class items and attributes
  item_names <- c("roc", "prc")
  attr_names <- c("model_name", "nn", "np", "args", "src", "validated")
  arg_names <- c("x_interval", "na.last", "ties.method", "obslevels",
                 "model_name")
  .validate_basic(curves, "curves", "calc_measures", item_names, attr_names,
                  arg_names)

  # Check values of class items
  curves[["roc"]] <- .validate(curves[["roc"]])
  curves[["prc"]] <- .validate(curves[["prc"]])

  attr(curves, "validated") <- TRUE
  curves
}
