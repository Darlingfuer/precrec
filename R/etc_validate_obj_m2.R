# Validate 'mfmdat' object generated by reformat_mdata()
.validate.mfmdat <- function(mfmdat) {
  # Need to validate only once
  if (class(mfmdat) == "curves" && attr(mfmdat, "validated")) {
    return
  }

  lapply(mfmdat, .validate)

  mfmdat$validated = TRUE
  mfmdat
}

# Validate 'sdat' object generated by create_mdat()
.validate.sdat <- function(sdat) {
  # Need to validate only once
  if (exists("validated", where = sdat) && sdat[["validated"]]) {
    return
  }

  # Check sdat
  if (class(sdat) != "sdat") {
    stop("'sdat' S3 object created by create_mdat() expected")
  }

  if (!exists("scores", where = sdat[["sdat"]])
      || !exists("obslabs", where = sdat[["sdat"]])) {
    stop("'mdat' contains elements with incorrect format")
  }

  if (length(sdat[["sdat"]][["scores"]]) !=  length(sdat[["sdat"]][["obslabs"]])) {
    stop("'scores' and 'obslabs' must be of the same length")
  }

  sdat$validated = TRUE
  sdat
}

# Validate 'mdat' object generated by create_mdat()
.validate.mdat <- function(mdat) {
  # Need to validate only once
  if (exists("validated", where = mdat) && mdat[["validated"]]) {
    return
  }

  # Check mdat
  if (class(mdat) != "mdat") {
    stop("'mdat' S3 object created by create_mdat() expected")
  }

#   efunc <- function(v) {
#     if (!exists("scores", where = mdat[["mdat"]][[v]])
#         || !exists("obslabs", where = mdat[["mdat"]][[v]])) {
#       stop("'mdat' contains elements with incorrect format")
#     }
#   }
#   res <- mapply(efunc, seq_along(mdat[["mdat"]]), SIMPLIFY = FALSE)

  mdat$validated = TRUE
  mdat
}

# Validate 'mroc_curves' object generated by .get_curves()
.validate.mroc_curves <- function(mroc_curves) {
  # Need to validate only once
  if (exists("validated", where = mroc_curves) && mroc_curves[["validated"]]) {
    return
  }

  # Check mroc_curves
  if (class(mroc_curves) != "mroc_curves") {
    stop("'mroc_curves' S3 object created by .get_curves() expected")
  }

  mroc_curves$validated = TRUE
  mroc_curves
}

# Validate 'mprc_curves' object generated by .get_curves()
.validate.mprc_curves <- function(mprc_curves) {
  # Need to validate only once
  if (exists("validated", where = mprc_curves) && mprc_curves[["validated"]]) {
    return
  }

  # Check mprc_curves
  if (class(mprc_curves) != "mprc_curves") {
    stop("'mroc_curves' S3 object created by .get_curves() expected")
  }

  mprc_curves$validated = TRUE
  mprc_curves
}

# Validate 'mcurves' object generated by evalmulti()
.validate.mcurves <- function(mcurves) {
  # Need to validate only once
  if (exists("validated", where = mcurves) && mcurves[["validated"]]) {
    return
  }

  # Check mcurves
  if (class(mcurves) != "mcurves") {
    stop("'mcurves' S3 object created by evalmulti() expected")
  }

  vfunc <- function(s) {
    .validate(mcurves[["mcurves"]][[s]])
  }
  mapply(vfunc, seq_along(mcurves[["mcurves"]]))

  mcurves$validated = TRUE
  mcurves
}

