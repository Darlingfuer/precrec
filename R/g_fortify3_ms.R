#' Convert an mcurves object to a data frame for ggplot2.
#'
#' \code{fortify} takes an \code{mcurves} object generated by
#' \code{\link{evalmulti}} and convert it to a data frame .
#' \code{fortify} requires \code{\link[ggplot2]{ggplot2}}.
#'
#' @param model \code{mcurves} object generated by
#'   \code{\link{evalmulti}}.
#' @param data Not used by this method.
#' @param ... Further arguments (ignored).
#' @return \code{fortify} retruns a data frame for \code{ggplot2}.
#'
#' @examples
#' library(ggplot2)
#' s1 <- c(1, 2, 3, 4)
#' s2 <- c(5, 6, 7, 8)
#' s3 <- c(2, 4, 6, 8)
#' mscores <- join_scores(s1, s2, s3)
#'
#' l1 <- c(1, 0, 1, 1)
#' l2 <- c(1, 1, 0, 0)
#' l3 <- c(0, 1, 0, 1)
#' mobslabs <- join_labels(l1, l2, l3)
#'
#' model_names <- c("t1", "t2", "t3")
#' mdat <- mmdata(mscores, mobslabs)
#' mcurves <- evalmulti(mdat, model_names = model_names)
#' df <- fortify(mcurves)
#'
#' df_roc <- subset(df, group == "ROC")
#' p_roc <- ggplot2::ggplot(df_roc, aes(x = x, y = y, color = model_name))
#' p_roc <- p_roc + geom_line()
#' p_roc
#'
#' df_prc <- subset(df, group == "PRC")
#' p_prc <- ggplot2::ggplot(df_prc, aes(x = x, y = y, color = model_name))
#' p_prc <- p_prc + geom_line()
#' p_prc
fortify.mscurves <- function(model, data = NULL, ...) {
  # === Check package availability  ===
  .load_ggplot2()

  # === Validate input arguments ===
  .validate(model)

  # === Prepare a data frame for ggplot2 ===
  roc_df <- ggplot2::fortify(model[["rocs"]])
  prc_df <- ggplot2::fortify(model[["prcs"]])
  x <- c(roc_df[["x"]], prc_df[["x"]])
  y <- c(roc_df[["y"]], prc_df[["y"]])
  model_name <- factor(c(roc_df[["model_name"]], prc_df[["model_name"]]),
                       labels = levels(roc_df[["model_name"]]))
  group = factor(c(rep("ROC", length(roc_df[["x"]])),
                   rep("PRC", length(prc_df[["x"]]))))

  df <- data.frame(x = x, y = y, group = group, model_name = model_name)
}

#
# Convert a mroc_curves object to a data frame for ggplot2.
#
fortify.msroc <- function(model, data = NULL, ...) {
  # === Check package availability  ===
  .load_ggplot2()

  # === Validate input arguments ===
  .validate(model)

  # === Prepare a data frame for ggplot2 ===
  df <- NULL
  modnames <- attr(model, "model_names")
  for (i in seq_along(model)) {
    x = model[[i]][["x"]]
    y = model[[i]][["y"]]
    model_name = factor(rep(modnames[i], length(x)), levels = modnames)
    df <- rbind(df, data.frame(x = x, y = y, model_name = model_name))
  }

  df
}

#
# Convert a mprc_curves object to a data frame for ggplot2.
#
fortify.msprc <- function(model, data = NULL, ...) {
  fortify.msroc(model, data = NULL, ...)
}
